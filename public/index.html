<!doctype html>
<html>

<head>
    <title>Senseekan</title>
    <style>
        #viewer {
            width: 100vw;
            height: 100vh;
            position: relative;
            background-color: #000000;
        }
    </style>
</head>
<script> 
    const ws = new WebSocket('ws://' + window.location.host + '/ws')
    function sendDirection(direction) {
      console.log(`Sending direction: ${direction}`)
      ws.send(JSON.stringify({direction}))
    }
</script>

<body>
    <div id="viewer" />
    <div id="buttoncontainer">
   	<button type="button" onmousedown="sendDirection('left')" 
			      onmouseup="sendDirection('stop')"
			      onmouseleave="sendDirection('stop')">Left</button>
   	<button type="button" onmousedown="sendDirection('forward')" 
			      onmouseup="sendDirection('stop')"
			      onmouseout="sendDirection('stop')">Forward</button>
   	<button type="button" onmousedown="sendDirection('right')" 
			      onmouseup="sendDirection('stop')" 
		              onmouseout="sendDirection('stop')">Right</button>
    </div>
</body>
<script src="three.min.js "></script>
<script src="thetaview.js "></script>
<script>

    // Create a canvas element for rendering each frame to.Note that this
    // canvas is not actually added to the DOM, it's just for computations.
    const videoImage = document.createElement('canvas')
    videoImage.id = '2d'
    videoImage.width = 1024
    videoImage.height = 1024

    // Get the context to draw into. We render the image into the canvas,
    // and then create a texture from the result. Actual rendering happens
    // later during `animate`
    const context = videoImage.getContext('2d')
    context.fillStyle = '#FF00FF'
    context.fillRect(0, 0, videoImage.width, videoImage.height)

    const viewer = document.getElementById('viewer')
    const thetaView = new ThetaView()

    // Start capturing images from the MJPEG Stream
    const image = new Image()
    image.src = '/stream'
    image.crossOrigin = "anonymous"
    thetaView.setContainer(viewer)
    thetaView.start(videoImage)
    animate()

    function animate() {
        requestAnimationFrame(animate)
        context.drawImage(image, 0, 0, videoImage.width, videoImage.height)
    }
</script>

</html>
